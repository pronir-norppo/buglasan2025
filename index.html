<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Buglasan 2025 - Deployment Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    :root {
      --bg: #0a0a0a;
      --panel: #121212;
      --text: #f3f3f3;
      --gold: #ffcc00;
      --accent1: #ff0077;
      --accent2: #ff6600;
      --accent3: #ffee00;
      --accent4: #00ff99;
      --accent5: #0099ff;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Inter, Arial, sans-serif;
    }
    header {
      background: linear-gradient(90deg, var(--accent1), var(--accent2), var(--accent3), var(--accent4), var(--accent5));
      background-size: 300% 300%;
      background-color: var(--bg);
      animation: gradientFlow 8s linear infinite;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 14px;
      position: relative;
      z-index: 1;
    }
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.3);
      z-index: -1;
    }
    @keyframes gradientFlow {
      0% { background-position: 0 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0 50%; }
    }
    header img { height: 50px; border-radius: 50%; background: #fff; padding: 1.1px; }
    header h1 { margin: 0; font-size: 18px; font-weight: 700; color: #fff; text-shadow: 0 1px 6px rgba(0,0,0,0.6); }
    nav { margin-left: auto; display: flex; gap: 10px; align-items: center; }
    nav select, nav button { transition: 0.2s all; }
    nav select:hover, nav button:hover { background: #0f0; color: #000; }
    nav select, nav button { padding: 6px 10px; border-radius: 8px; border: none; background: #1f1f1f; color: #fff; }
    .app { display: flex; height: calc(100vh - 72px); }
    .sidebar { width: 32%; min-width: 320px; background: var(--panel); padding: 14px; overflow: auto; border-right: 1px solid rgba(255,255,255,0.04); }
    h1 { margin-left: 10px; padding: 4px 8px; border-radius: 4px; color: #fff; font-family: 'Helvetica'; font-size: 28px; font-weight: 400; letter-spacing: 0.5px; }
    h2 { margin: 0 0 8px 0; color: var(--gold); font-size: 14px; text-transform: uppercase; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 8px; border: 1px solid rgba(255,255,255,0.2); vertical-align: middle; }
    th { color: var(--gold); text-align: left; }
    .person-row { cursor: pointer; }
    .person-row:hover { background: rgba(0,255,204,0.03); }
    .person-row.selected { background: rgba(255,204,0,0.08); color: var(--gold); }
    .main { flex: 1; position: relative; padding: 8px; }
    #map { height: 100%; border-radius: 8px; overflow: hidden; }
    #summaryBox { position: absolute; left: 12px; bottom: 12px; background: rgba(0,0,0,0.6); padding: 8px; border-radius: 6px; color: var(--gold); font-size: 10px; }
    .leaflet-popup-content-wrapper { max-height: 70vh; overflow-y: auto; }
    .leaflet-popup-content { font-size: 12px; line-height: 1.4; max-width: 300px; }
    .leaflet-popup-content img { max-width: 100%; height: auto; }
    @media (max-width: 880px) { .sidebar { width: 42%; } }
  </style>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/logo.png" alt="Buglasan 2025 Logo">
    <h1>Buglasan Festival 2025 â€” Deployment Dashboard</h1>
    <nav>
      <select id="areaFilter"><option value="All">All Areas</option></select>
      <select id="shiftFilterTop"><option value="All">All Shifts</option></select>
      <button id="refreshBtn">Refresh</button>
    </nav>
    <div id="clock" style="margin-left:10px; padding: 4px 8px; background: rgba(0,0,0,0.4); border-radius: 4px; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 12px; font-weight: 400; letter-spacing: 0.5px;"></div>
  </header>

  <div class="app">
    <div class="sidebar">
      <div id="lastUpdated" style="font-size:11px;color:#aaa;margin-bottom:4px">Last updated: --</div><br>
      <h2>List of Personnel</h2>
      <table id="personnelTable">
        <thead>
          <tr><th>Name of TL</th><th>Contact</th><th>Call Sign</th><th>Shift</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div style="margin-top:10px"><span id="togglePersonnel" style="color:var(--accent5);cursor:pointer;display:none">Show more</span></div>
    </div>

    <div class="main">
      <div id="map"></div>
      <div id="summaryBox">Summary...</div>
    </div>
  </div>

<script>
document.write(unescape('%3Cscript%3E%0A/*%20--------------------%20Configuration%20--------------------%20*/%0Aconst%20DEPLOYMENT_CSV%20%3D%20%22https%3A//docs.google.com/spreadsheets/d/e/2PACX-1vR4VtzZRxV-Z2wes5L5yta77awXf7PMEaDJPu1nvFr1hXEcRa7NaHPk2R0McPW-xMTsKSCuufRXoE7U/pub%3Foutput%3Dcsv%22%3B%0A%0A/*%20--------------------%20Helpers%20--------------------%20*/%0Afunction%20escapeHtml%28s%29%20%7B%20return%20%28s%20%7C%7C%20%27%27%29.toString%28%29.replace%28/%5B%26%3C%3E%22%27%5D/g%2C%20c%20%3D%3E%20%28%7B%20%27%26%27%3A%20%27%26amp%3B%27%2C%20%27%3C%27%3A%20%27%26lt%3B%27%2C%20%27%3E%27%3A%20%27%26gt%3B%27%2C%20%27%22%27%3A%20%27%26quot%3B%27%2C%20%22%27%22%3A%20%27%26%2339%3B%27%20%7D%29%5Bc%5D%29%3B%20%7D%0Afunction%20normalize%28s%29%20%7B%20return%20%28s%20%7C%7C%20%27%27%29.toString%28%29.trim%28%29.toLowerCase%28%29%3B%20%7D%0A%0Afunction%20getField%28row%2C%20...keys%29%20%7B%0A%20%20if%20%28%21row%29%20return%20%27%27%3B%0A%20%20for%20%28const%20k%20of%20keys%29%20%7B%20if%20%28k%20in%20row%20%26%26%20row%5Bk%5D%29%20return%20row%5Bk%5D%3B%20%7D%0A%20%20const%20cols%20%3D%20Object.keys%28row%20%7C%7C%20%7B%7D%29%3B%0A%20%20for%20%28const%20k%20of%20keys%29%20%7B%0A%20%20%20%20const%20target%20%3D%20k.toString%28%29.trim%28%29.toLowerCase%28%29%3B%0A%20%20%20%20for%20%28const%20c%20of%20cols%29%20%7B%0A%20%20%20%20%20%20if%20%28c%20%26%26%20c.toString%28%29.trim%28%29.toLowerCase%28%29.includes%28target%29%20%26%26%20row%5Bc%5D%29%20return%20row%5Bc%5D%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20return%20%27%27%3B%0A%7D%0A%0Aasync%20function%20fetchCsv%28url%29%20%7B%0A%20%20const%20sep%20%3D%20url.includes%28%27%3F%27%29%20%3F%20%27%26%27%20%3A%20%27%3F%27%3B%0A%20%20const%20res%20%3D%20await%20fetch%28url%20+%20%60%24%7Bsep%7Dt%3D%24%7BDate.now%28%29%7D%60%2C%20%7B%20cache%3A%20%27no-store%27%20%7D%29%3B%0A%20%20if%20%28%21res.ok%29%20throw%20new%20Error%28%27CSV%20fetch%20failed%3A%20%27%20+%20res.status%29%3B%0A%20%20const%20txt%20%3D%20await%20res.text%28%29%3B%0A%20%20return%20Papa.parse%28txt%2C%20%7B%20header%3A%20true%2C%20skipEmptyLines%3A%20true%20%7D%29.data%3B%0A%7D%0A%0Afunction%20parseLatLng%28val%29%20%7B%0A%20%20if%20%28%21val%29%20return%20null%3B%0A%20%20const%20parts%20%3D%20String%28val%29.replace%28/%5B%28%29%5D/g%2C%20%27%27%29.split%28/%5B%3B%2C%5Cs%5D+/%29.filter%28Boolean%29%3B%0A%20%20if%20%28parts.length%20%3E%3D%202%29%20%7B%0A%20%20%20%20const%20a%20%3D%20parseFloat%28parts%5B0%5D%29%2C%20b%20%3D%20parseFloat%28parts%5B1%5D%29%3B%0A%20%20%20%20if%20%28%21isNaN%28a%29%20%26%26%20%21isNaN%28b%29%29%20return%20%7B%20lat%3A%20a%2C%20lng%3A%20b%20%7D%3B%0A%20%20%7D%0A%20%20return%20null%3B%0A%7D%0A%0Afunction%20parsePersonnel%28raw%29%20%7B%0A%20%20if%20%28%21raw%29%20return%20%5B%5D%3B%0A%20%20return%20String%28raw%29.split%28/%5B%3B%5Cn%2C%5D+/%29.map%28x%20%3D%3E%20x.trim%28%29%29.filter%28Boolean%29.map%28p%20%3D%3E%20%7B%0A%20%20%20%20const%20m%20%3D%20p.match%28/%5E%28.*%3F%29%28%5Cs*%5C%28%3F%5Cs*%28%5C+%3F%5B0-9%5D%7B8%2C14%7D%29%5C%29%3F%29%3F%24/%29%3B%0A%20%20%20%20if%20%28m%29%20%7B%0A%20%20%20%20%20%20let%20num%20%3D%20m%5B3%5D%20%3F%20m%5B3%5D.trim%28%29%20%3A%20%27%27%3B%0A%20%20%20%20%20%20if%20%28num%29%20%7B%0A%20%20%20%20%20%20%20%20const%20digits%20%3D%20num.replace%28/%5CD/g%2C%20%27%27%29%3B%0A%20%20%20%20%20%20%20%20if%20%28digits.length%20%3D%3D%3D%2011%20%26%26%20digits.startsWith%28%270%27%29%29%20num%20%3D%20%27+63%27%20+%20digits.slice%281%29%3B%0A%20%20%20%20%20%20%20%20else%20if%20%28digits.length%20%3D%3D%3D%2010%20%26%26%20digits.startsWith%28%279%27%29%29%20num%20%3D%20%27+63%27%20+%20digits%3B%0A%20%20%20%20%20%20%20%20else%20if%20%28%21num.startsWith%28%27+%27%29%20%26%26%20/%5E%5Cd+%24/.test%28num%29%29%20num%20%3D%20digits%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20%7B%20name%3A%20m%5B1%5D.trim%28%29%2C%20mobile%3A%20num%20%7D%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20%7B%20name%3A%20p%2C%20mobile%3A%20%27%27%20%7D%3B%0A%20%20%7D%29%3B%0A%7D%0A%0Afunction%20makeDisplayUrl%28raw%29%20%7B%0A%20%20if%20%28%21raw%29%20return%20%27%27%3B%0A%20%20let%20url%20%3D%20String%28raw%29.trim%28%29%3B%0A%20%20const%20m%20%3D%20url.match%28/IMAGE%5C%28%5B%22%27%5D%3F%28https%5B%5E%22%27%29%5D+%29%5B%22%27%5D%3F%5C%29/i%29%3B%0A%20%20if%20%28m%29%20url%20%3D%20m%5B1%5D%3B%0A%20%20try%20%7B%0A%20%20%20%20if%20%28url.includes%28%22open%3Fid%3D%22%29%29%20%7B%0A%20%20%20%20%20%20const%20id%20%3D%20new%20URL%28url%29.searchParams.get%28%22id%22%29%3B%0A%20%20%20%20%20%20if%20%28id%29%20return%20%60https%3A//drive.google.com/thumbnail%3Fid%3D%24%7Bid%7D%26sz%3Dw420%60%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28url.includes%28%22/file/d/%22%29%29%20%7B%0A%20%20%20%20%20%20const%20match%20%3D%20url.match%28/%5C/file%5C/d%5C/%28%5B%5E/%5D+%29%5C//%29%3B%0A%20%20%20%20%20%20if%20%28match%29%20return%20%60https%3A//drive.google.com/thumbnail%3Fid%3D%24%7Bmatch%5B1%5D%7D%26sz%3Dw420%60%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28url.startsWith%28%22http%22%29%29%20return%20url%3B%0A%20%20%7D%20catch%20%28e%29%20%7B%0A%20%20%20%20console.warn%28%22%5BIMG%20PARSER%5D%20Failed%3A%22%2C%20raw%2C%20e%29%3B%0A%20%20%7D%0A%20%20return%20%27https%3A//via.placeholder.com/160x90.png%27%3B%0A%7D%0A%0Afunction%20normalizeToViber%28num%29%20%7B%0A%20%20if%20%28%21num%29%20return%20%27%27%3B%0A%20%20let%20n%20%3D%20String%28num%29.trim%28%29%3B%0A%20%20if%20%28n.startsWith%28%27+%27%29%29%20return%20n%3B%0A%20%20const%20digits%20%3D%20n.replace%28/%5CD/g%2C%20%27%27%29%3B%0A%20%20if%20%28digits.length%20%3D%3D%3D%2011%20%26%26%20digits.startsWith%28%270%27%29%29%20return%20%27+63%27%20+%20digits.slice%281%29%3B%0A%20%20if%20%28digits.length%20%3D%3D%3D%2010%20%26%26%20digits.startsWith%28%279%27%29%29%20return%20%27+63%27%20+%20digits%3B%0A%20%20return%20digits%20%7C%7C%20%27%27%3B%0A%7D%0A%0A/*%20--------------------%20DOM%20refs%20--------------------%20*/%0Aconst%20areaFilter%20%3D%20document.getElementById%28%27areaFilter%27%29%3B%0Aconst%20shiftFilterTop%20%3D%20document.getElementById%28%27shiftFilterTop%27%29%3B%0Aconst%20personnelTbody%20%3D%20document.querySelector%28%27%23personnelTable%20tbody%27%29%3B%0Aconst%20summaryBox%20%3D%20document.getElementById%28%27summaryBox%27%29%3B%0Aconst%20togglePersonnel%20%3D%20document.getElementById%28%27togglePersonnel%27%29%3B%0A%0A/*%20--------------------%20State%20--------------------%20*/%0Alet%20allData%20%3D%20%5B%5D%2C%20displayedMarkers%20%3D%20%5B%5D%2C%20personnelExpanded%20%3D%20false%2C%20selectedStation%20%3D%20%27All%27%2C%20selectedShift%20%3D%20%27All%27%3B%0A%0A//%20----%20Map%20Setup%20----%0Aconst%20DEFAULT_CENTER%20%3D%20%5B9.3095427%2C%20123.2887356%5D%3B%0Aconst%20DEFAULT_ZOOM%20%3D%2014.5%3B%0A%0Aconst%20map%20%3D%20L.map%28%27map%27%2C%20%7B%0A%20%20zoomSnap%3A%200.1%2C%0A%20%20zoomDelta%3A%200.5%2C%0A%20%20minZoom%3A%204%2C%0A%20%20maxZoom%3A%2022%2C%0A%20%20zoomControl%3A%20true%0A%7D%29.setView%28DEFAULT_CENTER%2C%20DEFAULT_ZOOM%29%3B%0A%0AL.tileLayer%28%27https%3A//%7Bs%7D.tile.openstreetmap.org/%7Bz%7D/%7Bx%7D/%7By%7D.png%27%2C%20%7B%0A%20%20attribution%3A%20%27%26copy%3B%20PICTMU%2C%20NOrPPO%2C%20PRO%20NIR%27%2C%0A%20%20maxZoom%3A%2022%0A%7D%29.addTo%28map%29%3B%0A%0Amap.whenReady%28%28%29%20%3D%3E%20setTimeout%28%28%29%20%3D%3E%20map.invalidateSize%28%29%2C%20200%29%29%3B%0A%0A/*%20--------------------%20Clock%20Function%20--------------------%20*/%0Afunction%20updateClock%28%29%20%7B%0A%20%20const%20now%20%3D%20new%20Date%28%29%3B%0A%20%20const%20options%20%3D%20%7B%0A%20%20%20%20timeZone%3A%20%27Asia/Manila%27%2C%0A%20%20%20%20hour%3A%20%272-digit%27%2C%0A%20%20%20%20minute%3A%20%272-digit%27%2C%0A%20%20%20%20second%3A%20%272-digit%27%2C%0A%20%20%20%20hour24%3A%20false%0A%20%20%7D%3B%0A%20%20const%20timeString%20%3D%20now.toLocaleTimeString%28%27en-US%27%2C%20options%29%3B%0A%20%20document.getElementById%28%27clock%27%29.textContent%20%3D%20timeString%3B%0A%7D%0A%0AsetInterval%28updateClock%2C%201000%29%3B%0AupdateClock%28%29%3B%0A%0A/*%20--------------------%20Markers%20%26%20UI%20rendering%20--------------------%20*/%0Afunction%20clearMarkers%28%29%20%7B%0A%20%20displayedMarkers.forEach%28m%20%3D%3E%20%7B%20try%20%7B%20map.removeLayer%28m.marker%29%3B%20%7D%20catch%28e%29%20%7B%7D%20%7D%29%3B%0A%20%20displayedMarkers%20%3D%20%5B%5D%3B%0A%7D%0A%0Afunction%20renderPopup%28record%29%20%7B%0A%20%20const%20wrapper%20%3D%20document.createElement%28%27div%27%29%3B%0A%20%20wrapper.style.maxWidth%20%3D%20%27300px%27%3B%0A%20%20wrapper.style.maxHeight%20%3D%20%2770vh%27%3B%0A%20%20wrapper.style.overflowY%20%3D%20%27auto%27%3B%0A%20%20let%20html%20%3D%20%60%3Cstrong%3E%24%7BescapeHtml%28record.area%29%7D%3C/strong%3E%3Cbr%3E%0A%20%20%20%20%3Cb%3EShift%3A%3C/b%3E%20%24%7BescapeHtml%28record.displayShift%20%7C%7C%20record.shift%20%7C%7C%20%27Unspecified%27%29%7D%3Cbr%3E%0A%20%20%20%20%3Cb%3ECommunication%20Capability%3A%3C/b%3E%20%24%7BescapeHtml%28record.comm%29%7D%3Cbr%3E%0A%20%20%20%20%3Cb%3ECall%20Sign%3A%3C/b%3E%20%24%7BescapeHtml%28record.callsign%29%7D%3Cbr%3E%0A%20%20%20%20%3Cb%3EStandby%20Point%3A%3C/b%3E%20%24%7BescapeHtml%28record.landmark%29%7D%3Cbr%3E%0A%20%20%20%20%3Cb%3EPersonnel%20on%20Duty%3A%3C/b%3E%3Cbr%3E%60%3B%0A%20%20%0A%20%20if%20%28record.PersonnelList%20%26%26%20record.PersonnelList.length%29%20%7B%0A%20%20%20%20record.PersonnelList.forEach%28%28p%2C%20index%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20v%20%3D%20p.mobile%20%7C%7C%20%27%27%3B%0A%20%20%20%20%20%20const%20viber%20%3D%20normalizeToViber%28v%29%3B%0A%20%20%20%20%20%20const%20link%20%3D%20viber%20%3F%20%60%3Cb%3E%3Ca%20href%3D%22viber%3A//chat%3Fnumber%3D%24%7BencodeURIComponent%28viber%29%7D%22%20style%3D%22border-radius%3A%205px%3Bbackground%3A%230f0%3Bcolor%3A%23000%3Btext-decoration%3Anone%22%3E%24%7BescapeHtml%28v%29%7D%3C/a%3E%3C/b%3E%60%20%3A%20%27no%20mobile%27%3B%0A%20%20%20%20%20%20html%20+%3D%20%60%24%7Bindex%20+%201%7D.%20%24%7BescapeHtml%28p.name%29%7D%3Cbr%3E%3Cspan%20style%3D%22margin-left%3A15px%3Bopacity%3A0.9%22%3EMobile%20%23%3A%20%24%7Blink%7D%3C/span%3E%3Cbr%3E%60%3B%0A%20%20%20%20%7D%29%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20html%20+%3D%20%27%3Cspan%20style%3D%22opacity%3A0.9%22%3ENo%20personnel%20listed%3C/span%3E%3Cbr%3E%27%3B%0A%20%20%7D%0A%0A%20%20wrapper.innerHTML%20%3D%20html%3B%0A%0A%20%20if%20%28record.photo%29%20%7B%0A%20%20%20%20const%20imgUrl%20%3D%20makeDisplayUrl%28record.photo%20%7C%7C%20%22%22%29%3B%0A%20%20%20%20if%20%28imgUrl%29%20%7B%0A%20%20%20%20%20%20const%20img%20%3D%20document.createElement%28%27img%27%29%3B%0A%20%20%20%20%20%20img.src%20%3D%20imgUrl%3B%0A%20%20%20%20%20%20img.style.maxWidth%20%3D%20%27100%25%27%3B%0A%20%20%20%20%20%20img.style.height%20%3D%20%27auto%27%3B%0A%20%20%20%20%20%20img.style.display%20%3D%20%27block%27%3B%0A%20%20%20%20%20%20img.style.marginTop%20%3D%20%276px%27%3B%0A%20%20%20%20%20%20img.style.borderRadius%20%3D%20%278px%27%3B%0A%20%20%20%20%20%20img.style.boxShadow%20%3D%20%270%200%2012px%20rgba%280%2C255%2C204%2C0.3%29%27%3B%0A%20%20%20%20%20%20img.onerror%20%3D%20%28%29%20%3D%3E%20%7B%20img.style.display%20%3D%20%27none%27%3B%20%7D%3B%0A%20%20%20%20%20%20wrapper.appendChild%28img%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20return%20wrapper%3B%0A%7D%0A%0Afunction%20addMarkerFor%28record%29%20%7B%0A%20%20if%20%28%21record.latlng%29%20return%20null%3B%0A%0A%20%20const%20s%20%3D%20normalize%28record.shift%20%7C%7C%20%27%27%29%3B%0A%20%20const%20area%20%3D%20normalize%28record.area%20%7C%7C%20%27%27%29%3B%0A%0A%20%20//%20---%20SHIFT%20ICONS%20%28default%201st%u20133rd%20shift%29%20---%0A%20%20const%20shiftConfigs%20%3D%20%5B%0A%20%20%20%20%7B%0A%20%20%20%20%20%20pattern%3A%20/1st.*shift/i%2C%0A%20%20%20%20%20%20label%3A%20%27Shift%201%27%2C%0A%20%20%20%20%20%20iconUrl%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/1st-Shift.png%27%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20pattern%3A%20/2nd.*shift/i%2C%0A%20%20%20%20%20%20label%3A%20%27Shift%202%27%2C%0A%20%20%20%20%20%20iconUrl%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/2nd-Shift.png%27%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20pattern%3A%20/3rd.*shift/i%2C%0A%20%20%20%20%20%20label%3A%20%27Shift%203%27%2C%0A%20%20%20%20%20%20iconUrl%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/3rd-Shift.png%27%0A%20%20%20%20%7D%0A%20%20%5D%3B%0A%0A%20%20//%20---%20AREA-SPECIFIC%20ICONS%20---%0A%20%20const%20areaIcons%20%3D%20%7B%0A%20%20%20%20%27llmscc%27%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/llmsc.jpg%27%2C%0A%20%20%20%20%27perdices%20coliseum%27%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/perdices.jpg%27%2C%0A%20%20%20%20%27dumaguete%20city%20street%20%28parade%20and%20street%20dance%29%27%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/parade.jpg%27%2C%0A%20%20%20%20%27esca%F1o%20beach%20%28music%20feast%29%27%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/music.jpg%27%2C%0A%20%20%20%20%27boulevard%20area%27%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/boulevard.jpg%27%2C%0A%20%20%20%20%27plenary%20hall%27%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/plenary.jpg%27%2C%0A%20%20%7D%3B%0A%0A%20%20let%20iconUrl%20%3D%20null%3B%0A%20%20let%20label%20%3D%20%27%27%3B%0A%0A%20%20//%20%uD83D%uDFE1%20Check%20if%20the%20area%20matches%20one%20of%20the%20special%20event%20locations%0A%20%20for%20%28const%20key%20in%20areaIcons%29%20%7B%0A%20%20%20%20if%20%28area.includes%28key%29%29%20%7B%0A%20%20%20%20%20%20iconUrl%20%3D%20areaIcons%5Bkey%5D%3B%0A%20%20%20%20%20%20label%20%3D%20record.area%3B%0A%20%20%20%20%20%20break%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20//%20%uD83D%uDD35%20If%20no%20area%20icon%20matched%2C%20fall%20back%20to%20shift%20icons%20%28Capitol%201%u20133%20included%29%0A%20%20if%20%28%21iconUrl%29%20%7B%0A%20%20%20%20const%20shiftMatch%20%3D%20shiftConfigs.find%28sc%20%3D%3E%20s.match%28sc.pattern%29%29%3B%0A%20%20%20%20iconUrl%20%3D%20shiftMatch%20%3F%20shiftMatch.iconUrl%20%3A%20%27https%3A//raw.githubusercontent.com/pronir-norppo/buglasan2025/refs/heads/main/unspecified.png%27%3B%0A%20%20%20%20label%20%3D%20shiftMatch%20%3F%20shiftMatch.label%20%3A%20%27Unspecified%27%3B%0A%20%20%7D%0A%0A%20%20//%20Create%20marker%20icon%0A%20%20const%20icon%20%3D%20L.icon%28%7B%0A%20%20%20%20iconUrl%2C%0A%20%20%20%20iconSize%3A%20%5B34%2C%2034%5D%2C%0A%20%20%20%20iconAnchor%3A%20%5B17%2C%2034%5D%2C%0A%20%20%20%20popupAnchor%3A%20%5B0%2C%20-34%5D%2C%0A%20%20%20%20shadowUrl%3A%20%27https%3A//unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png%27%2C%0A%20%20%20%20shadowSize%3A%20%5B41%2C%2041%5D%2C%0A%20%20%20%20shadowAnchor%3A%20%5B12%2C%2040%5D%0A%20%20%7D%29%3B%0A%0A%20%20const%20marker%20%3D%20L.marker%28%5Brecord.latlng.lat%2C%20record.latlng.lng%5D%2C%20%7B%20icon%20%7D%29.addTo%28map%29%3B%0A%20%20record.displayShift%20%3D%20label%3B%0A%20%20marker.bindPopup%28renderPopup%28record%29%29%3B%0A%20%20displayedMarkers.push%28%7B%20marker%2C%20data%3A%20record%20%7D%29%3B%0A%20%20return%20marker%3B%0A%7D%0A%0A/*%20--------------------%20Table%20rendering%20--------------------%20*/%0Afunction%20renderPersonnelTable%28filtered%29%20%7B%0A%20%20personnelTbody.innerHTML%20%3D%20%27%27%3B%0A%20%20if%20%28selectedStation%20%3D%3D%3D%20%27All%27%29%20%7B%0A%20%20%20%20personnelTbody.innerHTML%20%3D%20%27%3Ctr%3E%3Ctd%20colspan%3D%224%22%20style%3D%22opacity%3A0.6%3Bpadding%3A10px%3Btext-align%3Acenter%22%3ESelect%20Area%20to%20view%20duty%20personnel%3C/td%3E%3C/tr%3E%27%3B%0A%20%20%20%20togglePersonnel.style.display%20%3D%20%27none%27%3B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%0A%20%20const%20shiftConfigs%20%3D%20%5B%0A%20%20%20%20%7B%20pattern%3A%20/1st.*shift/i%2C%20color%3A%20%27green%27%2C%20label%3A%20%27Shift%201%27%20%7D%2C%0A%20%20%20%20%7B%20pattern%3A%20/2nd.*shift/i%2C%20color%3A%20%27purple%27%2C%20label%3A%20%27Shift%202%27%20%7D%2C%0A%20%20%20%20%7B%20pattern%3A%20/3rd.*shift/i%2C%20color%3A%20%27orange%27%2C%20label%3A%20%27Shift%203%27%20%7D%2C%0A%20%20%20%20%7B%20pattern%3A%20/other/i%2C%20color%3A%20%27gray%27%2C%20label%3A%20%27Others%27%20%7D%2C%0A%20%20%20%20%7B%20pattern%3A%20/.*/%2C%20color%3A%20%27yellow%27%2C%20label%3A%20%27Unspecified%27%20%7D%0A%20%20%5D%3B%0A%0A%20%20const%20rows%20%3D%20%5B%5D%3B%0A%20%20filtered.forEach%28r%20%3D%3E%20%7B%0A%20%20%20%20const%20personnelList%20%3D%20r.PersonnelList%20%7C%7C%20%5B%5D%3B%0A%20%20%20%20const%20firstPerson%20%3D%20personnelList%5B0%5D%20%7C%7C%20%7B%20name%3A%20%27Unnamed%27%2C%20mobile%3A%20%27%27%20%7D%3B%0A%20%20%20%20const%20name%20%3D%20personnelList.length%20%3E%201%20%3F%20%60%24%7BfirstPerson.name%7D%20and%20buddy%60%20%3A%20firstPerson.name%3B%0A%20%20%20%20const%20mobile%20%3D%20firstPerson.mobile%20%7C%7C%20%27%27%3B%0A%20%20%20%20const%20s%20%3D%20normalize%28r.shift%20%7C%7C%20%27%27%29%3B%0A%20%20%20%20const%20shiftMatch%20%3D%20shiftConfigs.find%28sc%20%3D%3E%20s.match%28sc.pattern%29%29%3B%0A%20%20%20%20const%20shiftColor%20%3D%20shiftMatch%20%3F%20shiftMatch.color%20%3A%20%27yellow%27%3B%0A%20%20%20%20const%20shiftLabel%20%3D%20r.displayShift%20%7C%7C%20%28shiftMatch%20%3F%20shiftMatch.label%20%3A%20%27Unspecified%27%29%3B%0A%20%20%20%20rows.push%28%7B%20name%3A%20name%2C%20mobile%3A%20mobile%2C%20call%3A%20r.callsign%20%7C%7C%20%27%27%2C%20shift%3A%20shiftLabel%2C%20shiftColor%2C%20r%20%7D%29%3B%0A%20%20%7D%29%3B%0A%0A%20%20const%20visible%20%3D%20personnelExpanded%20%3F%20rows%20%3A%20rows.slice%280%2C%206%29%3B%0A%20%20visible.forEach%28p%20%3D%3E%20%7B%0A%20%20%20%20const%20tr%20%3D%20document.createElement%28%27tr%27%29%3B%0A%20%20%20%20tr.className%20%3D%20%27person-row%27%3B%0A%20%20%20%20const%20viberNum%20%3D%20normalizeToViber%28p.mobile%29%3B%0A%20%20%20%20const%20viberLink%20%3D%20viberNum%20%3F%20%60%3Ca%20href%3D%22viber%3A//chat%3Fnumber%3D%24%7BencodeURIComponent%28viberNum%29%7D%22%20style%3D%22color%3A%2300ffcc%3Btext-decoration%3Anone%22%3E%24%7BescapeHtml%28p.mobile%29%7D%3C/a%3E%60%20%3A%20%27no%20mobile%27%3B%0A%20%20%20%20tr.innerHTML%20%3D%20%60%3Ctd%3E%24%7BescapeHtml%28p.name%29%7D%3C/td%3E%3Ctd%3E%24%7BviberLink%7D%3C/td%3E%3Ctd%3E%24%7BescapeHtml%28p.call%29%7D%3C/td%3E%3Ctd%20style%3D%22color%3A%24%7Bp.shiftColor%7D%22%3E%24%7BescapeHtml%28p.shift%29%7D%3C/td%3E%60%3B%0A%20%20%20%20tr.onclick%20%3D%20%28%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20document.querySelectorAll%28%27.person-row.selected%27%29.forEach%28x%20%3D%3E%20x.classList.remove%28%27selected%27%29%29%3B%0A%20%20%20%20%20%20tr.className%20%3D%20%27person-row%20selected%27%3B%0A%20%20%20%20%20%20const%20m%20%3D%20displayedMarkers.find%28x%20%3D%3E%20x.data%20%3D%3D%3D%20p.r%29%3B%0A%20%20%20%20%20%20if%20%28m%29%20%7B%0A%20%20%20%20%20%20%20%20map.flyTo%28m.marker.getLatLng%28%29%2C%2018%29%3B%0A%20%20%20%20%20%20%20%20m.marker.openPopup%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%3B%0A%20%20%20%20personnelTbody.appendChild%28tr%29%3B%0A%20%20%7D%29%3B%0A%20%20togglePersonnel.style.display%20%3D%20rows.length%20%3E%206%20%3F%20%27inline-block%27%20%3A%20%27none%27%3B%0A%20%20togglePersonnel.textContent%20%3D%20personnelExpanded%20%3F%20%27Show%20less%27%20%3A%20%60Show%20more%20%28%24%7Brows.length%7D%29%60%3B%0A%7D%0A%0A/*%20--------------------%20Summary%20--------------------%20*/%0Afunction%20updateSummary%28filtered%29%20%7B%0A%20%20const%20total%20%3D%20filtered.reduce%28%28a%2C%20r%29%20%3D%3E%20a%20+%20%28%28r.PersonnelList%20%26%26%20r.PersonnelList.length%29%20%7C%7C%201%29%2C%200%29%3B%0A%20%20summaryBox.innerHTML%20%3D%20%28selectedStation%20%3D%3D%3D%20%27All%27%29%20%3F%20%60Total%20Personnel%3A%20%24%7Btotal%7D%60%20%3A%20%60%3Cb%3E%24%7BescapeHtml%28selectedStation%29%7D%3C/b%3E%3Cbr%3EPersonnel%3A%20%24%7Btotal%7D%60%3B%0A%7D%0A%0A/*%20--------------------%20Apply%20filters%20--------------------%20*/%0Afunction%20applyFilters%28%29%20%7B%0A%20%20clearMarkers%28%29%3B%0A%20%20const%20filtered%20%3D%20allData.filter%28d%20%3D%3E%0A%20%20%20%20%28selectedStation%20%3D%3D%3D%20%27All%27%20%7C%7C%20normalize%28d.area%29%20%3D%3D%3D%20normalize%28selectedStation%29%29%20%26%26%0A%20%20%20%20%28selectedShift%20%3D%3D%3D%20%27All%27%20%7C%7C%20normalize%28d.shift%29%20%3D%3D%3D%20normalize%28selectedShift%29%29%0A%20%20%29%3B%0A%0A%20%20if%20%28%21filtered.length%29%20%7B%0A%20%20%20%20personnelTbody.innerHTML%20%3D%20%27%3Ctr%3E%3Ctd%20colspan%3D%224%22%20style%3D%22opacity%3A0.6%3Bpadding%3A10px%3Btext-align%3Acenter%22%3ENo%20deployments%20found%3C/td%3E%3C/tr%3E%27%3B%0A%20%20%20%20summaryBox.innerHTML%20%3D%20%27%u26A0%uFE0F%20No%20data%20found.%27%3B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%0A%20%20filtered.forEach%28r%20%3D%3E%20addMarkerFor%28r%29%29%3B%0A%20%20renderPersonnelTable%28filtered%29%3B%0A%20%20updateSummary%28filtered%29%3B%0A%7D%0A%0A/*%20--------------------%20Load%20CSV%20and%20initialize%20--------------------%20*/%0Aasync%20function%20loadData%28%29%20%7B%0A%20%20try%20%7B%0A%20%20%20%20const%20rows%20%3D%20await%20fetchCsv%28DEPLOYMENT_CSV%29%3B%0A%20%20%20%20allData%20%3D%20rows.map%28r%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20record%20%3D%20%7B%0A%20%20%20%20%20%20%20%20raw%3A%20r%2C%0A%20%20%20%20%20%20%20%20area%3A%20getField%28r%2C%20%27Area%20of%20Deployment%27%2C%20%27Area%27%29%2C%0A%20%20%20%20%20%20%20%20shift%3A%20getField%28r%2C%20%27Duty%20Shift%27%2C%20%27Shift%27%29%2C%0A%20%20%20%20%20%20%20%20comm%3A%20getField%28r%2C%20%27Communication%20Capability%27%2C%20%27Comm%27%29%2C%0A%20%20%20%20%20%20%20%20callsign%3A%20getField%28r%2C%20%27Call%20Sign%27%2C%20%27Callsign%27%29%2C%0A%20%20%20%20%20%20%20%20landmark%3A%20getField%28r%2C%20%27Stanbypoint%20%28Landmark%29%27%2C%20%27Standbypoint%27%2C%20%27Standby%20Point%27%29%2C%0A%20%20%20%20%20%20%20%20photo%3A%20getField%28r%2C%20%27Picture%20%28with%20Timestamp%29%27%2C%20%27Picture%27%2C%20%27Photo%27%29%2C%0A%20%20%20%20%20%20%20%20latlng%3A%20parseLatLng%28getField%28r%2C%20%27Lat_Long%20%28e.g.%209.33608%2C%20123.30659%29%27%2C%20%27Lat_Long%27%2C%20%27Coordinates%27%29%29%2C%0A%20%20%20%20%20%20%20%20PersonnelList%3A%20parsePersonnel%28getField%28r%2C%20%27Personnel%20%28Rank_FName_MI_LN%20%28Contact%20%23%29%27%2C%20%27Personnel%27%29%29%0A%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%20%20if%20%28record.photo%29%20record.photo%20%3D%20makeDisplayUrl%28record.photo%29%3B%0A%20%20%20%20%20%20return%20record%3B%0A%20%20%20%20%7D%29%3B%0A%0A%20%20%20%20const%20areas%20%3D%20%5B...new%20Set%28allData.map%28d%20%3D%3E%20%28d.area%20%7C%7C%20%27Unknown%27%29.trim%28%29%29%29%5D.sort%28%29%3B%0A%20%20%20%20areaFilter.innerHTML%20%3D%20%27%3Coption%20value%3D%22All%22%3EAll%20Areas%3C/option%3E%27%20+%20areas.map%28a%20%3D%3E%20%60%3Coption%20value%3D%22%24%7BescapeHtml%28a%29%7D%22%3E%24%7BescapeHtml%28a%29%7D%3C/option%3E%60%29.join%28%27%27%29%3B%0A%20%20%20%20const%20shifts%20%3D%20%5B...new%20Set%28allData.map%28d%20%3D%3E%20%28d.shift%20%7C%7C%20%27Unspecified%27%29.trim%28%29%29%29%5D.sort%28%29%3B%0A%20%20%20%20shiftFilterTop.innerHTML%20%3D%20%27%3Coption%20value%3D%22All%22%3EAll%20Shifts%3C/option%3E%27%20+%20shifts.map%28s%20%3D%3E%20%60%3Coption%20value%3D%22%24%7BescapeHtml%28s%29%7D%22%3E%24%7BescapeHtml%28s%29%7D%3C/option%3E%60%29.join%28%27%27%29%3B%0A%0A%20%20%20%20selectedStation%20%3D%20%27All%27%3B%0A%20%20%20%20selectedShift%20%3D%20%27All%27%3B%0A%20%20%20%20applyFilters%28%29%3B%0A%20%20%20%20updateTimestamp%28%29%3B%0A%20%20%7D%20catch%20%28err%29%20%7B%0A%20%20%20%20console.error%28err%29%3B%0A%20%20%20%20alert%28%27Failed%20to%20load%20CSV.%20Make%20sure%20the%20sheet%20is%20published%20as%20CSV%20and%20URL%20is%20public.%27%29%3B%0A%20%20%7D%0A%7D%0A%0Afunction%20updateTimestamp%28%29%20%7B%0A%20%20const%20el%20%3D%20document.getElementById%28%27lastUpdated%27%29%3B%0A%20%20if%20%28%21el%29%20return%3B%0A%20%20const%20now%20%3D%20new%20Date%28%29%3B%0A%20%20const%20options%20%3D%20%7B%20year%3A%20%27numeric%27%2C%20month%3A%20%27long%27%2C%20day%3A%20%27numeric%27%2C%20hour%3A%20%272-digit%27%2C%20minute%3A%20%272-digit%27%20%7D%3B%0A%20%20el.textContent%20%3D%20%22Last%20updated%3A%20%22%20+%20now.toLocaleString%28%27en-US%27%2C%20options%29%3B%0A%7D%0A%0A/*%20--------------------%20Events%20--------------------%20*/%0AareaFilter.onchange%20%3D%20%28%29%20%3D%3E%20%7B%20selectedStation%20%3D%20areaFilter.value%3B%20applyFilters%28%29%3B%20updateTimestamp%28%29%3B%20%7D%3B%0AshiftFilterTop.onchange%20%3D%20%28%29%20%3D%3E%20%7B%20selectedShift%20%3D%20shiftFilterTop.value%3B%20applyFilters%28%29%3B%20updateTimestamp%28%29%3B%20%7D%3B%0AtogglePersonnel.onclick%20%3D%20%28%29%20%3D%3E%20%7B%20personnelExpanded%20%3D%20%21personnelExpanded%3B%20applyFilters%28%29%3B%20updateTimestamp%28%29%3B%20%7D%3B%0Adocument.getElementById%28%27refreshBtn%27%29.onclick%20%3D%20%28%29%20%3D%3E%20loadData%28%29%3B%0A%0A/*%20--------------------%20Start%20--------------------%20*/%0AloadData%28%29%3B%0A%3C/script%3E'));
</script>

</body>
</html>
